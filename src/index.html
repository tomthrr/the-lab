<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
            name="viewport"
            content="width=device-width, minimal-ui, viewport-fit=cover, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    />
    <link rel="icon" type="image/png" href="/favicon.ico" />

    <title>The lab</title>
    <link href="assets/globals.scss" rel="stylesheet" />
    <link href="assets/main.scss" rel="stylesheet" />
</head>
<body class="app">
<div class="container">
    <div class="menu">
        <h1>The labo ðŸ§ª</h1>
        <div class="category">
            <p class="title">3D</p>
            <a class="link" data-src="simple-geometries.html">Simple geometries</a>
            <a class="link" data-src="load-textures.html">Load textures</a>
            <a class="link" data-src="3d-text.html">3D text</a>
            <a class="link" data-src="add-lights.html">Add lights</a>
            <a class="link" data-src="add-shadows.html">Add shadows</a>
            <a class="link" data-src="create-scene-haunted-house.html">Create a scene : haunted house</a>
            <a class="link" data-src="particles-wave.html">Particles wave</a>
            <a class="link" data-src="galaxy-generator.html">Galaxy generator</a>
            <a class="link" data-src="scroll-base.html">Scroll base</a>
            <a class="link" data-src="add-physics.html">Add physics</a>
            <a class="link" data-src="import-models.html">Import models</a>
            <a class="link" data-src="raycaster.html">Raycaster and mouse events</a>
            <a class="link" data-src="first-shader.html">First shader</a>
            <a class="link" data-src="marble-torso.html">Marble torso</a>
            <a class="link" data-src="3d-cube.html">3D cube</a>
            <a class="link" data-src="scroll-earth.html">3D earth</a>
        </div>
    </div>
    <iframe title="selected project" class="iframe" allow="autoplay" src=""></iframe>
</div>
<a class="close-icon">&lt;</a>
<a class="code-icon" href="" target="_blank">&lt;&#47;&gt;</a>
<script type="module">
    const projectsLinks = document.querySelectorAll('a.link');
    const iFrame = document.querySelector('.iframe');
    const closeButton = document.querySelector('.close-icon');
    const menu = document.querySelector('.menu');

    closeButton.addEventListener('click', () => {
        menu.classList.toggle('closed');
        iFrame.classList.toggle('resized');
        closeButton.classList.toggle('replace');
    });

    let loadQuery = location.search.split('src=');

    if (loadQuery[1]) {
        // si le fichier n'existe pas ou n'est pas dans l'url
        let isThere = false;
        projectsLinks.forEach((link) => {
            if (link.dataset.src === loadQuery[1]) {
                isThere = true;
            }
        });
        if (isThere) {
            // on load un projet spÃ©cifique
            iFrame.src = loadQuery[1];
            highlight(loadQuery[1]);
        } else {
            // sinon un projet random
            let target = projectsLinks[Math.floor(Math.random() * projectsLinks.length)];
            updateExample({ target });
        }

    } else {
        // On load un projet random
        let target = projectsLinks[Math.floor(Math.random() * projectsLinks.length)];
        updateExample({ target });
    }

    projectsLinks.forEach((link) => {
        link.addEventListener('click', updateExample, false);
    });

    function    updateExample(e) {
        let src = e.target.dataset.src;

        // Control clique possible
        if (e.metaKey) {
            window.open(`${location.origin}${location.pathname}?src=${src}`, '_blank');
            return;
        }

      iFrame.src = e.target.dataset.src;
      highlight(src);

      history.pushState(null, null, `${location.origin}${location.pathname}?src=${src}`);
      e.preventDefault && e.preventDefault();
    }


    function highlight(src) {
        projectsLinks.forEach((link) => {
            let linkSrc = link.href.split('examples/')[1];
            if (src === linkSrc) link.classList.add('active');
            else link.classList.remove('active');
        });
    }
</script>
</body>
</html>